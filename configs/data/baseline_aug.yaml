# Step 1: Baseline Augmentation (고정 768x768 + Rotation)
# 목표: F1 0.85, 예상 시간: 1시간
# 전략: Aspect ratio 유지 + Padding + 회전 augmentation

# 이미지 크기 (고정)
img_size: 768

# 정규화 (ImageNet)
normalization:
  mean: [0.485, 0.456, 0.406]
  std: [0.229, 0.224, 0.225]

# Augmentation
augmentation:
  enabled: true

  # 학습 증강
  train_augmentations:
    # ============ Resize 전략 (Aspect Ratio 보존) ============
    # 1. 긴 쪽을 768로 맞춤 (AR 유지)
    - type: "LongestMaxSize"
      max_size: 768
      interpolation: 1  # INTER_LINEAR

    # 2. 부족한 부분을 흰색으로 패딩 (문서 배경색)
    - type: "PadIfNeeded"
      min_height: 768
      min_width: 768
      border_mode: 0  # cv2.BORDER_CONSTANT
      value: [255, 255, 255]  # 흰색 패딩
      # position: "center" # 이미지 위치 항상 중앙으로 정제
      p: 1.0

    # ============ Rotation Augmentation (핵심) ============
    # 회전 문제 해결: 학습 데이터에 다양한 회전 추가

    # 90도 단위 회전 (추론 데이터 대응)
    - type: "RandomRotate90"
      p: 0.5

    # ±45도 회전 (다양한 각도 대응)
    - type: "Rotate"
      limit: [-45, 45]
      border_mode: 0  # cv2.BORDER_CONSTANT
      value: [255, 255, 255]  # 흰색 배경
      p: 0.3

    # 좌우 반전 : 삭제 검토 필요
    - type: "HorizontalFlip"
      p: 0.5

    # 상하 반전
    - type: "VerticalFlip"
      p: 0.2

    # ============ 문서 특화 Augmentation ============
    # 대비 강화 (Ink/Paper 분리)
    - type: "CLAHE"
      clip_limit: 4.0
      tile_grid_size: [8, 8]
      p: 0.4

    # 밝기/대비 조정 (그림자 제거)
    - type: "RandomBrightnessContrast"
      brightness_limit: 0.2
      contrast_limit: 0.3
      p: 0.3

    # 원근 변환 (스캔 각도)
    - type: "Perspective"
      scale: [0.05, 0.1]
      p: 0.2

    # 색상 변화 (종이 색상)
    - type: "ColorJitter"
      brightness: 0.1
      contrast: 0.1
      saturation: 0.1
      hue: 0.05
      p: 0.2

    # 노이즈 (스캔 노이즈)
    - type: "GaussNoise"
      var_limit: [10.0, 30.0]
      p: 0.1

    # 선명도 조정
    - type: "Sharpen"
      alpha: [0.2, 0.5]
      lightness: [0.5, 1.0]
      p: 0.2

  # 검증/테스트 증강
  val_augmentations:
    # Resize (동일한 전략)
    - type: "LongestMaxSize"
      max_size: 768
      interpolation: 1

    - type: "PadIfNeeded"
      min_height: 768
      min_width: 768
      border_mode: 0
      value: [255, 255, 255]
      p: 1.0

    # Validation에는 CLAHE만 적용 (대비 개선)
    - type: "CLAHE"
      clip_limit: 4.0
      tile_grid_size: [8, 8]
      p: 1.0

# 데이터셋 분할
train_val_split: 0.8

# 클래스 불균형 처리
use_class_weights: true
